<!DOCTYPE html>
<html>
  <head>
    <title>Post</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  </head>
  <body>
    {% block navbar %} {% include 'forum/CommentCreation.html' %}  {% endblock %}
    <div class="container mt-8">
      <div class="post">
        <h1 class="post-title">{{ post.title }}</h1>
        <div class="post-content">{{ post.content | safe }}</div>
      </div>

      <!-- comments.html -->

        <div class="comments">
      {% for comment in comment_list %}
        <div class="comment">
          {% if current_user.id == comment.commenter %}
            <!-- Edit button for the comment -->
            <button class="edit-btn" onclick="openEditForm({{ comment.id }})">Edit</button>
          {% endif %}
          <div class="comment-content" id="comment-content-{{ comment.id }}">
            {{ comment.content | safe }}
          </div>
          {% if comment.image %}
            <img src="{{ url_for('static', filename='images/' + comment.image) }}" alt="Uploaded Image">
          {% endif %}
          <div class="comment-details">
            <!-- Display the comment poster -->
            <span>Posted by {{ comment.commenter }}</span>
          </div>
        </div>

        <!-- Edit form for the comment -->
        <form class="edit-form hidden" id="edit-form-{{ comment.id }}" action="{{ url_for('forum.edit_comment', comment_id=comment.id) }}" method="POST" enctype="multipart/form-data">
          {{ form.csrf_token }}
          <label for="content-{{ comment.id }}">Edit Content:</label>
          <textarea id="content-{{ comment.id }}" name="content">{{ comment.content }}</textarea>
          <br>
          <input type="file" name="image" accept="image/*">
          <button type="submit">Save</button>
          <button type="button" onclick="closeEditForm({{ comment.id }})">Cancel</button>
        </form>
      {% endfor %}
    </div>

    </div>
  </body>

</html>
<script>
  // Function to open the edit form
  function openEditForm(commentId) {
    const form = document.getElementById(`edit-form-${commentId}`);
    form.classList.remove("hidden");

    // Fill the edit form with the current comment content
    const contentElem = document.getElementById(`comment-content-${commentId}`);
    const commentContent = contentElem.innerHTML;
    const commentImage = contentElem.nextElementSibling?.getAttribute("src");

    form.querySelector(`textarea[name="content"]`).value = commentContent;
    form.querySelector(`input[name="image"]`).value = commentImage;
  }

  // Function to close the edit form
  function closeEditForm(commentId) {
    const form = document.getElementById(`edit-form-${commentId}`);
    form.classList.add("hidden");
  }

  // Function to submit the edit form
  function submitEditForm(event, commentId) {
    event.preventDefault();

    const form = document.getElementById(`edit-form-${commentId}`);
    const formData = new FormData(form);

    // You can optionally perform client-side validation here before submission

    // Submit the form using the standard HTML form submission
    form.submit();
  }
</script>
